import * as cheerio from "https://esm.sh/cheerio@1.0.0-rc.12";
async function fetchSymbolPage(symbol) {
    const response = await fetch(`https://www.bvb.ro/FinancialInstruments/Details/FinancialInstrumentsDetails.aspx?s=${symbol}`);
    const responseData = await response.text();
    const selector = cheerio.load(responseData);
    const table = selector("#ctl00_body_ctl02_PricesControl_dvCPrices");
    const data = {};
    table.find("tr").each(function(i, row) {
        const name = selector(row).find("td:nth-child(1)");
        const value = selector(row).find("td:nth-child(2)");
        const key = name.text().trim();
        data[key] = value.text().trim();
    });
    return data;
}
async function getStockPriceFroBVB(symbol) {
    const stockRawData = await fetchSymbolPage(symbol);
    const stockPrice = parseFloat(stockRawData["Last price"]);
    if (!stockPrice && stockPrice !== 0) {
        throw new Error("Invalid stock price for " + symbol);
    }
    return stockPrice;
}
export { getStockPriceFroBVB };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vaG9tZS9ydW5uZXIvd29yay9zdG9jay1tYXJrZXQtc2NyYXBlci9zdG9jay1tYXJrZXQtc2NyYXBlci9zcmMvYnZiL3N0b2NrLXByaWNlLXNjcmFwZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2hlZXJpbyBmcm9tIFwiaHR0cHM6Ly9lc20uc2gvY2hlZXJpb0AxLjAuMC1yYy4xMlwiO1xuXG5pbnRlcmZhY2UgU3ltYm9sUGFnZURldGFpbHMge1xuICBcIkRhdGUvdGltZVwiOiBzdHJpbmc7XG4gIFwiTGFzdCBwcmljZVwiOiBzdHJpbmc7XG4gIFwiT3BlbiBwcmljZVwiOiBzdHJpbmc7XG4gIFwiSGlnaCBwcmljZVwiOiBzdHJpbmc7XG4gIFwiTG93IHByaWNlXCI6IHN0cmluZztcbiAgXCJBdmcuIHByaWNlXCI6IHN0cmluZztcbiAgXCI1MiB3ZWVrcyBoaWdoXCI6IHN0cmluZztcbiAgXCI1MiB3ZWVrcyBsb3dcIjogc3RyaW5nO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFN5bWJvbFBhZ2Uoc3ltYm9sOiBzdHJpbmcpIHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICBgaHR0cHM6Ly93d3cuYnZiLnJvL0ZpbmFuY2lhbEluc3RydW1lbnRzL0RldGFpbHMvRmluYW5jaWFsSW5zdHJ1bWVudHNEZXRhaWxzLmFzcHg/cz0ke3N5bWJvbH1gXG4gICk7XG4gIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcblxuICBjb25zdCBzZWxlY3RvciA9IGNoZWVyaW8ubG9hZChyZXNwb25zZURhdGEpO1xuXG4gIGNvbnN0IHRhYmxlID0gc2VsZWN0b3IoXCIjY3RsMDBfYm9keV9jdGwwMl9QcmljZXNDb250cm9sX2R2Q1ByaWNlc1wiKTtcbiAgY29uc3QgZGF0YTogU3ltYm9sUGFnZURldGFpbHMgPSB7fSBhcyBTeW1ib2xQYWdlRGV0YWlscztcbiAgdGFibGUuZmluZChcInRyXCIpLmVhY2goZnVuY3Rpb24gKGksIHJvdykge1xuICAgIGNvbnN0IG5hbWUgPSBzZWxlY3Rvcihyb3cpLmZpbmQoXCJ0ZDpudGgtY2hpbGQoMSlcIik7XG4gICAgY29uc3QgdmFsdWUgPSBzZWxlY3Rvcihyb3cpLmZpbmQoXCJ0ZDpudGgtY2hpbGQoMilcIik7XG4gICAgY29uc3Qga2V5ID0gbmFtZS50ZXh0KCkudHJpbSgpO1xuICAgIGRhdGFba2V5IGFzIGtleW9mIFN5bWJvbFBhZ2VEZXRhaWxzXSA9IHZhbHVlLnRleHQoKS50cmltKCk7XG4gIH0pO1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRTdG9ja1ByaWNlRnJvQlZCKHN5bWJvbDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgY29uc3Qgc3RvY2tSYXdEYXRhID0gYXdhaXQgZmV0Y2hTeW1ib2xQYWdlKHN5bWJvbCk7XG5cbiAgY29uc3Qgc3RvY2tQcmljZSA9IHBhcnNlRmxvYXQoc3RvY2tSYXdEYXRhW1wiTGFzdCBwcmljZVwiXSk7XG5cbiAgaWYgKCFzdG9ja1ByaWNlICYmIHN0b2NrUHJpY2UgIT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0b2NrIHByaWNlIGZvciBcIiArIHN5bWJvbCk7XG4gIH1cblxuICByZXR1cm4gc3RvY2tQcmljZTtcbn1cblxuZXhwb3J0IHsgZ2V0U3RvY2tQcmljZUZyb0JWQiB9O1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksYUFBYSxxQ0FBcUM7QUFhOUQsZUFBZSxnQkFBZ0IsTUFBYyxFQUFFO0lBQzdDLE1BQU0sV0FBVyxNQUFNLE1BQ3JCLENBQUMsbUZBQW1GLEVBQUUsT0FBTyxDQUFDO0lBRWhHLE1BQU0sZUFBZSxNQUFNLFNBQVMsSUFBSTtJQUV4QyxNQUFNLFdBQVcsUUFBUSxJQUFJLENBQUM7SUFFOUIsTUFBTSxRQUFRLFNBQVM7SUFDdkIsTUFBTSxPQUEwQixDQUFDO0lBQ2pDLE1BQU0sSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLFNBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtRQUN0QyxNQUFNLE9BQU8sU0FBUyxLQUFLLElBQUksQ0FBQztRQUNoQyxNQUFNLFFBQVEsU0FBUyxLQUFLLElBQUksQ0FBQztRQUNqQyxNQUFNLE1BQU0sS0FBSyxJQUFJLEdBQUcsSUFBSTtRQUM1QixJQUFJLENBQUMsSUFBK0IsR0FBRyxNQUFNLElBQUksR0FBRyxJQUFJO0lBQzFEO0lBRUEsT0FBTztBQUNUO0FBRUEsZUFBZSxvQkFBb0IsTUFBYyxFQUFtQjtJQUNsRSxNQUFNLGVBQWUsTUFBTSxnQkFBZ0I7SUFFM0MsTUFBTSxhQUFhLFdBQVcsWUFBWSxDQUFDLGFBQWE7SUFFeEQsSUFBSSxDQUFDLGNBQWMsZUFBZSxHQUFHO1FBQ25DLE1BQU0sSUFBSSxNQUFNLDZCQUE2QixRQUFRO0lBQ3ZELENBQUM7SUFFRCxPQUFPO0FBQ1Q7QUFFQSxTQUFTLG1CQUFtQixHQUFHIn0=